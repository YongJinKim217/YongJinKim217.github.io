<!DOCTYPE html>
<html>

<head>
    <title>Simple Game</title>
</head>

<body>
    <h1>SNAKE!</h1>

    <canvas id="canvas" width="400" height="400"></canvas>

    <p><em>By:</em> Francis and Jin</p>

    <p><em>For:</em> Genius Project</p>

    <script src="https://code.jquery.com/jquery-2.1.0.js"></script>


    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        ctx.fillStyle = "White";
        ctx.fillRect(0, 0, 400, 400);

        var snake = [
            { x: 8, y: 8 },
            { x: 7, y: 8 },
            { x: 6, y: 8 },
        ];

        var alive = true;

        var direction = "right";

        var food = {};

        var cube = function (x, y) {
            ctx.fillStyle = "Turquoise";
            ctx.fillRect(x, y, 25, 25);
        };

        var foodCube = function (x, y) {
            ctx.fillStyle = "Red";
            ctx.fillRect(x, y, 25, 25);
        };

        var actions = {
            37: "left",
            38: "up",
            39: "right",
            40: "down"
        };

        var makeFood = function () {
            var foodY = Math.floor(Math.random() * 16)
            var foodX = Math.floor(Math.random() * 16)
            for (i = 0; i < snake.length; i++) {
                if (snake[i].x === foodX && snake[i].y === foodY) {
                    makeFood();
                    return
                }
            }
            food = { x: foodX, y: foodY };
        };

        snake.die = function () {
            alert("You died!");
            alert(`Your final length was ${snake.length - 1}`);
            alert("Press the spacebar to try again");
            alive = false;
        };

        snake.checkSnake = function () {
            if (snake[0].x < 0 || snake[0].x > 15 || snake[0].y < 0 || snake[0].y > 15) {
                return "die";
            }
            for (i = 1; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
                    return "die";
                }
            }
            if (snake[0].x === food.x && snake[0].y === food.y) {
                makeFood()
                return "eaten";
            } else {
                return "normal";
            }
        };



        snake.move = function () {
            $("body").keydown(function (event) {
                var protoDirection = actions[event.keyCode];
                if (!((direction == "right" && protoDirection == "left") || (direction == "left" && protoDirection == "right") || (direction == "up" && protoDirection == "down") || (direction == "down" && protoDirection == "up"))) {
                    direction = protoDirection;
                }
            });
            if (direction == "left") {
                snake.unshift({ x: snake[0].x - 1, y: snake[0].y });
            } else if (direction == "right") {
                snake.unshift({ x: snake[0].x + 1, y: snake[0].y });
            } else if (direction == "up") {
                snake.unshift({ x: snake[0].x, y: snake[0].y - 1 });
            } else if (direction == "down") {
                snake.unshift({ x: snake[0].x, y: snake[0].y + 1 });
            }
            if (this.checkSnake() === "normal") {
                snake.pop();
            } else if (this.checkSnake() === "die") {
                snake.die();
            }
        };

        snake.draw = function () {
            ctx.fillStyle = "White";
            ctx.fillRect(0, 0, 400, 400);
            ctx.strokeStyle = "Black";
            ctx.strokeRect(0, 0, 400, 400)
            for (i = 0; i < snake.length; i++) {
                cube(snake[i].x * 25, snake[i].y * 25);
            }
            foodCube(food.x * 25, food.y * 25);
        };

        makeFood()

        var revive = "idk";

        setInterval(function () {
            if (!alive) {
                $("body").keydown(function (event) {
                    revive = event.keyCode;
                });
                if (revive == 32) {
                    window.location.reload();
                }
            } else {
                snake.move();
                snake.draw();
            }
        }, 250);
    </script>
</body>

</html>
